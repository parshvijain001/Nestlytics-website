<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Bird Species Database - Professional platform for analyzing Indian bird species distribution with interactive maps and statistical analysis.">
    <meta name="keywords"
        content="bird species, Indian birds, biodiversity, bird watching, species database, Delhi bird atlas">
    <title>Nestyltics- Indian Avian Biodiversity Analysis</title>
    <link rel="canonical" href="https://yourdomain.com">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🦅</text></svg>">

    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FF6B35, #F7931E, #FFD23F, #06FFA5, #4ECDC4);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            line-height: 1.6;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Header */
        .site-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 3px solid #FF6B35;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.3);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .site-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            font-size: 1.8rem;
            font-weight: bold;
            color: #FF6B35;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .site-logo:hover {
            transform: scale(1.05);
        }

        .nav-menu {
            display: flex;
            gap: 35px;
            align-items: center;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            color: #FF6B35;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        /* Page Container */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Home Page */
        .hero-section {
            text-align: center;
            color: white;
            padding: 60px 20px;
            margin-bottom: 40px;
        }

        .hero-title {
            font-size: 4rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #FFD23F, #06FFA5, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textShimmer 3s ease-in-out infinite;
        }

        @keyframes textShimmer {

            0%,
            100% {
                filter: hue-rotate(0deg);
            }

            50% {
                filter: hue-rotate(180deg);
            }
        }

        .hero-subtitle {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: white;
        }

        .hero-description {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 40px;
            opacity: 0.9;
        }

        .bird-collage {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .bird-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
        }

        .bird-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
        }

        .bird-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .bird-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }

            100% {
                left: 100%;
            }
        }

        .bird-name {
            padding: 15px;
            font-weight: bold;
            color: #FF6B35;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Features Page Styles */
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .upload-area {
            border: 3px dashed #228B22;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #32CD32;
            background: rgba(50, 205, 50, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2E8B57;
            margin-bottom: 10px;
        }

        .upload-subtitle {
            color: #666;
            font-size: 0.9rem;
        }

        #fileInput {
            display: none;
        }

        .datasets-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .datasets-title {
            font-size: 1.1rem;
            color: #2E8B57;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .dataset-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #32CD32;
        }

        .dataset-name {
            font-weight: 600;
            color: #2E8B57;
            margin-bottom: 8px;
        }

        .dataset-stats {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .dataset-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 0.75rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            color: white;
            transition: all 0.2s ease;
        }

        .btn-view {
            background: #17a2b8;
        }

        .btn-view:hover {
            background: #138496;
        }

        .btn-export {
            background: #28a745;
        }

        .btn-export:hover {
            background: #218838;
        }

        .btn-export-enhanced {
            background: #fd7e14;
        }

        .btn-export-enhanced:hover {
            background: #e55c0a;
        }

        .btn-delete {
            background: #dc3545;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #228B22;
        }

        .section-title {
            font-size: 1.4rem;
            color: #2E8B57;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #32CD32;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-controls {
            display: flex;
            gap: 10px;
        }

        .control-button {
            background: #2E8B57;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .control-button.active {
            background: #FFD700;
            color: #2E8B57;
        }

        #map {
            height: 500px;
            border-radius: 12px;
            border: 2px solid #f0f0f0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2E8B57, #228B22);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #2E8B57;
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #32CD32;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Enhanced Export Modal */
        .export-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .export-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #000;
        }

        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .export-option {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-option:hover {
            border-color: #32CD32;
            background: rgba(50, 205, 50, 0.1);
        }

        .export-option-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #2E8B57;
        }

        .export-option-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2E8B57;
            margin-bottom: 10px;
        }

        .export-option-desc {
            color: #666;
            font-size: 0.9rem;
        }

        .export-preview {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #32CD32;
        }

        .preview-files {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .preview-file {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .preview-file h4 {
            color: #2E8B57;
            margin-bottom: 10px;
        }

        .download-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }

        .download-btn:hover {
            background: #218838;
        }

        /* Contact Page */
        .contact-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 3px solid #FF6B35;
        }

        .contact-info {
            margin: 30px 0;
        }

        .contact-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            font-size: 1.2rem;
            color: #FF6B35;
        }

        /* Footer */
        .site-footer {
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            color: white;
            padding: 50px 30px 30px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #FFD23F;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section ul li a {
            color: white;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section ul li a:hover {
            color: #FFD23F;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 20px;
            text-align: center;
            opacity: 0.9;
        }

        .btn-primary {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.4);
            background: linear-gradient(45deg, #F7931E, #FFD23F);
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
            }

            .site-logo {
                font-size: 1.3rem;
            }

            .nav-menu {
                flex-direction: row;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-menu a {
                font-size: 0.9rem;
                padding: 8px 15px;
            }

            .hero-title {
                font-size: 2rem;
            }

            .hero-subtitle {
                font-size: 1.2rem;
            }

            .hero-description {
                font-size: 1rem;
            }

            .bird-collage {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .sidebar {
                order: 2;
                margin-bottom: 20px;
            }

            .content {
                order: 1;
            }

            .section {
                padding: 15px;
            }

            .section-title {
                font-size: 1.1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .map-controls {
                flex-direction: column;
                width: 100%;
            }

            .control-button,
            #boundarySelector {
                width: 100%;
            }

            #map {
                height: 300px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .chart-container {
                height: 250px;
            }

            .data-table {
                font-size: 0.85rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px;
            }

            .export-options {
                grid-template-columns: 1fr;
            }

            .preview-files {
                grid-template-columns: 1fr;
            }

            .export-modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
                text-align: center;
            }

            .footer-section {
                padding-left: 0;
            }

            .contact-section {
                padding: 20px;
            }

            .contact-item {
                font-size: 1rem;
                flex-direction: column;
                text-align: center;
            }

            #legendItems {
                flex-direction: column;
                align-items: stretch;
            }

            body {
                font-size: 14px;
                padding: 10px;
            }

            .container {
                padding: 10px;
            }

            .upload-area {
                padding: 20px;
            }

            .upload-icon {
                font-size: 2rem;
            }

            .upload-text {
                font-size: 0.95rem;
            }

            .upload-subtitle {
                font-size: 0.8rem;
            }

            .datasets-title {
                font-size: 1rem;
            }

            .dataset-name {
                font-size: 0.9rem;
            }

            .dataset-stats {
                font-size: 0.75rem;
            }

            .btn-small {
                font-size: 0.7rem;
                padding: 5px 8px;
            }

            .stat-label {
                font-size: 0.8rem;
            }

            #legendItems>div {
                font-size: 0.75rem;
                padding: 4px 8px;
            }

            #legendItems>div>div {
                width: 10px;
                height: 10px;
            }

            .bird-name {
                font-size: 0.95rem;
                padding: 10px;
            }

            .footer-section h3 {
                font-size: 1.1rem;
            }

            .footer-section ul li {
                font-size: 0.9rem;
            }

            .export-option-icon {
                font-size: 2.5rem;
            }

            .export-option-title {
                font-size: 1rem;
            }

            .export-option-desc {
                font-size: 0.8rem;
            }

            .section {
                margin-bottom: 15px;
            }

            .hero-section {
                padding: 30px 15px;
            }

            .site-footer {
                padding: 30px 0 20px;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .stat-card {
                padding: 20px 12px;
                min-height: 110px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .stat-value {
                font-size: 1.8rem;
                margin-bottom: 8px;
                line-height: 1.2;
            }

            .stat-label {
                font-size: 0.85rem;
                line-height: 1.3;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .stat-card {
                padding: 22px 15px;
            }
        }


        /* Tablet specific styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .main-content {
                grid-template-columns: 300px 1fr;
                gap: 15px;
            }

            .bird-collage {
                grid-template-columns: repeat(3, 1fr);
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Footer specific mobile fixes */
            .footer-section {
                padding-left: 0;
                text-align: center;
            }

            .footer-section h3 {
                font-size: 1.05rem;
                margin-bottom: 15px;
            }

            .footer-section p {
                font-size: 0.85rem;
                line-height: 1.5;
            }

            .footer-section ul li {
                font-size: 0.85rem;
                margin-bottom: 8px;
                line-height: 1.4;
            }

            .footer-bottom {
                font-size: 0.8rem;
                padding-top: 15px;
            }

            /* Better Summary Statistics mobile styling */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-card {
                padding: 18px 12px;
            }

            .stat-value {
                font-size: 1.6rem !important;
                margin-bottom: 6px;
            }

            .stat-label {
                font-size: 0.82rem !important;
                line-height: 1.4;
            }

            /* For very small phones, stack cards vertically */
            @media (max-width: 480px) {
                .stats-grid {
                    grid-template-columns: 1fr;
                    gap: 10px;
                }

                .stat-card {
                    padding: 20px 15px;
                }

                .stat-value {
                    font-size: 1.8rem !important;
                }
            }


        }

        .responsive-img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="site-header">
            <div class="header-container">
                <div class="site-logo" onclick="showPage('home')">
                    <span>🦅</span>
                    <span>Nestlytics</span>
                </div>
                <nav>
                    <ul class="nav-menu">
                        <li><a onclick="showPage('home')" class="nav-link active">Home</a></li>
                        <li><a onclick="showPage('features')" class="nav-link">Features</a></li>
                        <li><a onclick="showPage('contact')" class="nav-link">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Home Page -->
        <div id="home" class="page active">
            <section class="hero-section">
                <h1 class="hero-title">Birds' Species Database</h1>
                <p class="hero-subtitle"><b>Discover the Rich Avian Biodiversity of India</b></p>
                <p class="hero-description">
                    <b>Explore, analyze, and visualize bird species distribution patterns across India with
                        comprehensive statistical analysis and interactive mapping tools.</b>
                </p>

                <div class="bird-collage">

                    <div class="bird-card">
                        <div class="bird-image">
                            <img src="https://cdn.download.ams.birds.cornell.edu/api/v2/asset/133718611/1200"
                                class="responsive-img">
                        </div>
                        <div class="bird-name">Asian Openbill</div>
                    </div>
                    <div class="bird-card">
                        <div class="bird-image">
                            <img src="https://www.allaboutbirds.org/guide/assets/photo/305880301-480px.jpg"
                                class="responsive-img">
                        </div>
                        <div class="bird-name">House Sparrow</div>
                    </div>
                    <div class="bird-card">
                        <div class="bird-image">
                            <img src="https://jeevoka.com/story-images/267-39384b09-87a8-4d6e-ac50-24db10105cfe.jpg"
                                class="responsive-img">
                        </div>
                        <div class="bird-name">Ashy Prinia</div>
                    </div>
                    <div class="bird-card">
                        <div class="bird-image">
                            <img src="https://inaturalist-open-data.s3.amazonaws.com/photos/360494940/original.jpeg"
                                class="responsive-img">
                        </div>
                        <div class="bird-name">Asian Koel</div>
                    </div>

                    <div class="bird-card">
                        <div class="bird-image">
                            <img src="https://cdn.download.ams.birds.cornell.edu/api/v2/asset/126370921/900"
                                class="responsive-img">
                        </div>
                        <div class=" bird-name">Indian Robin
                        </div>
                    </div>
                    <div class="bird-card">
                        <div class="bird-image">
                            <img src="https://www.10000birds.com/wp-content/uploads/2025/04/Indian-Peafowl_ASC1106-Enhanced-NR_Bundala-NP-Sri-Lanka-Mar-22-2025.jpg"
                                class="responsive-img">
                        </div>
                        <div class="bird-name">Indian Peafowl</div>
                    </div>
                </div>


                <a onclick="showPage('features')" class="btn-primary">Explore Features</a>
            </section>
        </div>

        <!-- Features Page - Your single-page code integrated -->
        <div id="features" class="page">
            <div id="alertContainer"></div>

            <div class="main-content">
                <div class="sidebar">
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">📊</div>
                        <div class="upload-text"><b>Click to upload files</b></div>
                        <div class="upload-subtitle">Species data (CSV/Excel) + Study area boundaries (KML)</div>
                        <input type="file" id="fileInput" accept=".xlsx,.xls,.csv,.kml,.kmz" multiple>
                    </div>

                    <div class="datasets-section">
                        <div class="datasets-title">📂 <b>Your Datasets</b></div>
                        <div id="datasetsList">
                            <div style="text-align: center; color: #666; padding: 20px;">
                                No datasets uploaded yet.<br>Upload your first dataset to get started!
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <div class="section">
                        <div class="section-title">
                            <span>🌍 <b>Species Distribution Map</b></span>
                            <div class="map-controls">
                                <button id="toggleHeatmap" class="control-button" onclick="toggleHeatmapMode()">🔥
                                    <b>Heatmap</b> </button>
                                <button id="toggleMarkers" class="control-button active" onclick="toggleMarkerMode()">📍
                                    <b>Markers</b></button>
                                <button id="fitBounds" class="control-button" onclick="fitMapBounds()">🎯 <b>Fit</b>
                                    View</button>
                                <select id="boundarySelector" class="control-button" onchange="applyBoundary()">
                                    <option value=""><b>Select Study Area</b></option>
                                </select>
                            </div>
                        </div>

                        <div id="map"></div>
                        <div class="loading" id="mapLoading">
                            <div class="spinner"></div>
                            <p>Loading data...</p>
                        </div>

                        <!-- Species Color Legend -->
                        <div id="speciesLegend"
                            style="display: none; margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.9); border-radius: 8px; border: 1px solid #ddd;">
                            <h4 style="color: #2E8B57; margin-bottom: 10px; font-size: 1rem;">Species Legend</h4>
                            <div id="legendItems" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <!-- Legend items will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2 class="section-title">📊 Summary Statistics</h2>
                        <div class="stats-grid" id="statsGrid">
                            <div class="stat-card">
                                <div class="stat-value">0</div>
                                <div class="stat-label"><b>Total Observations</b></div>
                                <div class="stat-card"></div>
                                <div class="stat-value">0</div>
                                <div class="stat-label"><b>Unique Species</b></div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">0</div>
                                <div class="stat-label"><b>Survey Locations</b></div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">0/km²</div>
                                <div class="stat-label"><b>Avg. Density</b></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2 class="section-title">📈 Species Abundance Chart</h2>
                        <div class="chart-container">
                            <canvas id="speciesChart"></canvas>
                        </div>
                    </div>

                    <div class="section">
                        <h2 class="section-title">📋 Data Summary Table</h2>
                        <div style="overflow-x: auto;">
                            <table class="data-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>Species</th>
                                        <th>Total Count</th>
                                        <th>Observations</th>
                                        <th>Avg. per Observation</th>
                                        <th>Density</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="5" style="text-align: center; color: #999; padding: 30px;">
                                            No dataset selected. Upload or select a dataset to view analysis!
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact" class="page">
            <section class="hero-section">
                <h1 style="font-size: 3rem; color: white; margin-bottom: 20px;">Get In Touch</h1>
                <p style="font-size: 1.2rem; color: white; opacity: 0.9;"><b>Connect with the Delhi Bird Atlas team</b>
                </p>
            </section>

            <div class="contact-section">
                <h2 style="color: #FF6B35; margin-bottom: 30px; font-size: 2rem;">Contact Information</h2>

                <div class="contact-info">
                    <div class="contact-item">
                        <span style="font-size: 2rem; color: #F7931E;">📧</span>
                        <div>
                            <strong>Email:</strong>
                            <a href="mailto:pccf-gnctd@delhi.gov.in
" style="color: #FF6B35; text-decoration: none;">pccf-gnctd@delhi.gov.in
                            </a>
                        </div>
                    </div>

                    <div class="contact-item">
                        <span style="font-size: 2rem; color: #F7931E;">📱</span>
                        <div>
                            <strong>Instagram:</strong>
                            <a href="https://instagram.com/delhi_birdatlas" target="_blank"
                                style="color: #FF6B35; text-decoration: none;">@delhi_birdatlas</a>
                        </div>
                    </div>

                    <div class="contact-item">
                        <span style="font-size: 2rem; color: #F7931E;">🌍</span>
                        <div>
                            <strong>Focus Area:</strong>
                            Delhi & National Capital Region Bird Species
                        </div>
                    </div>
                </div>

                <div
                    style="margin-top: 40px; padding: 30px; background: linear-gradient(45deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1)); border-radius: 15px;">
                    <h3 style="color: #FF6B35; margin-bottom: 15px;">About Delhi Bird Atlas</h3>
                    <p style="color: #666; line-height: 1.8;">
                        <b>The Delhi Bird Atlas is a comprehensive initiative to document and analyze the avian
                            biodiversity of Delhi and surrounding regions.
                            Our platform provides researchers, bird watchers, and conservationists with powerful tools
                            to
                            visualize and understand bird distribution patterns.</b>
                    </p>
                </div>

                <div style="margin-top: 30px;">
                    <a href="https://instagram.com/delhi_birdatlas" target="_blank" class="btn-primary">
                        Follow Us on Instagram
                    </a>
                </div>
            </div>
        </div>

        <!-- Enhanced Export Modal -->
        <div id="exportModal" class="export-modal">
            <div class="export-modal-content">
                <span class="close-modal" onclick="closeExportModal()">&times;</span>
                <h2 style="color: #2E8B57; margin-bottom: 20px;">Choose Export Format</h2>

                <div class="export-options">
                    <div class="export-option" onclick="exportCSV()">
                        <div class="export-option-icon">📄</div>
                        <div class="export-option-title">CSV Data Export</div>
                        <div class="export-option-desc">Export raw species data in CSV format for analysis</div>
                    </div>

                    <div class="export-option" onclick="exportEnhanced()">
                        <div class="export-option-icon">🗺️</div>
                        <div class="export-option-title">Interactive HTML Export</div>
                        <div class="export-option-desc">Generate interactive maps and dashboards as HTML files</div>
                    </div>
                </div>

                <div id="enhancedExportContent" style="display: none;">
                    <div class="export-preview">
                        <h3 style="color: #2E8B57; text-align: center; margin-bottom: 20px;">Your Interactive Files Are
                            Ready!</h3>

                        <div id="previewStats" style="text-align: center; margin-bottom: 20px;">
                            <!-- Stats populated by JS -->
                        </div>

                        <div id="previewFiles" class="preview-files">
                            <!-- Files populated by JS -->
                        </div>

                        <div id="speciesSection" style="display: none;" class="species-section">
                            <h4 style="color: #2E8B57; margin-bottom: 15px;">Species-Specific Interactive Heatmaps</h4>
                            <div id="speciesGrid"
                                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto; padding: 15px; border: 1px solid #e9ecef; border-radius: 5px;">
                                <!-- Species items populated by JS -->
                            </div>
                            <div style="text-align: center; margin-top: 15px;">
                                <button onclick="downloadAllSpecies()" class="download-btn"
                                    style="background: #6f42c1;">
                                    📦 Download All Species Maps
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Nestlytics</h3>
                    <p>A comprehensive platform for analyzing Indian bird species distribution with interactive maps and
                        statistical analysis tools.</p>
                    <div style="margin-top: 15px;">
                        <a href="https://instagram.com/delhi_birdatlas" target="_blank"
                            style="color: #FFD23F; text-decoration: none; font-size: 1.2rem;">📱 @delhi_birdatlas</a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Platform Features</h3>
                    <ul>
                        <li>Interactive species distribution maps</li>
                        <li>Advanced heatmap visualizations</li>
                        <li>Statistical analysis and reporting</li>
                        <li>CSV/Excel data import</li>
                        <li>KML/KMZ boundary support</li>
                        <li>Downloadable HTML reports</li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('documentation')">Data Format
                                Guide</a></li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('tutorials')">How to Use</a></li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('bird-identification')">Bird ID
                                Guide</a></li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('methodology')">Research
                                Methodology</a></li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('publications')">Publications</a>
                        </li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Legal & Support</h3>
                    <ul>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('privacy')">Privacy Policy</a></li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('terms')">Terms of Service</a></li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('data-usage')">Data Usage Policy</a>
                        </li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('support')">Technical Support</a>
                        </li>
                        <li><a href="javascript:void(0)" onclick="showResourcePage('feedback')">Feedback &
                                Suggestions</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 Nestyltics : Bird Species Database Platform. Empowering avian biodiversity research and
                    conservation
                    efforts across India.</p>
            </div>
        </footer>
    </div>

    <script>
        // Your exact working JavaScript from single-page version
        let map, heatmapLayer, markersLayer, boundaryLayer, currentDatasetId = null, currentData = [];
        let speciesChart, currentMapMode = 'markers', availableBoundaries = [];
        let selectedExportDatasetId = null, currentExportData = null;

        // Page Navigation Function
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Add active class to corresponding nav link
            event.target.classList.add('active');

            // Initialize components when features page is shown
            if (pageId === 'features') {
                setTimeout(() => {
                    initMap();
                    initChart();
                }, 300);
            }
        }

        function initMap() {
            if (map) {
                map.remove();
            }
            map = L.map('map').setView([20.5937, 78.9629], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap'
            }).addTo(map);
            markersLayer = L.layerGroup().addTo(map);
            boundaryLayer = L.layerGroup().addTo(map);
        }

        function initChart() {
            const ctx = document.getElementById('speciesChart');
            if (!ctx) return;

            if (speciesChart) {
                speciesChart.destroy();
            }

            speciesChart = new Chart(ctx.getContext('2d'), {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Species Distribution',
                        data: [],
                        backgroundColor: [
                            'rgba(255, 107, 53, 0.8)',
                            'rgba(247, 147, 30, 0.8)',
                            'rgba(255, 210, 63, 0.8)',
                            'rgba(6, 255, 165, 0.8)',
                            'rgba(78, 205, 196, 0.8)',
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(78, 205, 132, 0.8)',
                            'rgba(69, 183, 209, 0.8)',
                            'rgba(150, 206, 180, 0.8)',
                            'rgba(255, 234, 167, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 107, 53, 1)',
                            'rgba(247, 147, 30, 1)',
                            'rgba(255, 210, 63, 1)',
                            'rgba(6, 255, 165, 1)',
                            'rgba(78, 205, 196, 1)',
                            'rgba(255, 107, 107, 1)',
                            'rgba(78, 205, 132, 1)',
                            'rgba(69, 183, 209, 1)',
                            'rgba(150, 206, 180, 1)',
                            'rgba(255, 234, 167, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // File upload handling
        function handleFileUpload(e) {
            if (e.target.files.length > 0) uploadFiles(e.target.files);
        }

        async function uploadFiles(files) {
            for (let file of files) {
                try {
                    const fileType = file.name.split('.').pop().toUpperCase();
                    const isBoundaryFile = ['KML', 'KMZ'].includes(fileType);

                    showAlert(`Uploading ${file.name}...`, 'success');

                    const formData = new FormData();
                    formData.append('file', file);
                    const response = await fetch('/api/upload', { method: 'POST', body: formData });
                    const result = await response.json();

                    if (result.success) {
                        if (result.is_boundary) {
                            showAlert('✅ Boundary loaded successfully', 'success');
                            await loadBoundaryList();
                        } else {
                            showAlert('✅ Species data loaded successfully', 'success');
                            await loadDatasetsList();
                            if (result.dataset_id) await loadDataset(result.dataset_id);
                        }
                    } else {
                        showAlert('❌ Error: ' + result.message, 'error');
                    }
                } catch (error) {
                    showAlert('❌ Failed to upload ' + file.name, 'error');
                }
            }
            document.getElementById('fileInput').value = '';
        }

        async function loadBoundaryList() {
            try {
                const response = await fetch('/api/boundaries');
                const result = await response.json();
                if (result.success) {
                    availableBoundaries = result.boundaries;
                    updateBoundarySelector();
                }
            } catch (error) {
                console.error('Error loading boundaries:', error);
            }
        }

        function updateBoundarySelector() {
            const selector = document.getElementById('boundarySelector');
            let html = '<option value="">Select Study Area</option>';
            availableBoundaries.forEach(boundary => {
                html += `<option value="${boundary.id}">${boundary.name}</option>`;
            });
            selector.innerHTML = html;
        }

        async function applyBoundary() {
            const boundaryId = document.getElementById('boundarySelector').value;
            boundaryLayer.clearLayers();

            if (!boundaryId) return;

            const boundary = availableBoundaries.find(b => b.id === boundaryId);
            if (boundary && boundary.bounds && boundary.bounds.coordinates) {
                const polygon = L.polygon(boundary.bounds.coordinates, {
                    color: '#FF0000', weight: 3, opacity: 0.8,
                    fillColor: '#FF0000', fillOpacity: 0.1
                });
                boundaryLayer.addLayer(polygon);

                const bounds = L.latLngBounds([boundary.bounds.south, boundary.bounds.west],
                    [boundary.bounds.north, boundary.bounds.east]);
                map.fitBounds(bounds, { padding: [20, 20] });
            }
        }

        async function loadDatasetsList() {
            try {
                const response = await fetch('/api/datasets');
                const result = await response.json();
                if (result.success) updateDatasetsList(result.datasets);
            } catch (error) {
                console.error('Error loading datasets:', error);
            }
        }

        function updateDatasetsList(datasets) {
            const container = document.getElementById('datasetsList');
            if (datasets.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No datasets uploaded yet.</div>';
                return;
            }

            let html = '';
            datasets.forEach(dataset => {
                html += `
                    <div class="dataset-item">
                        <div class="dataset-name">${dataset.name}</div>
                        <div class="dataset-stats">${dataset.total_records} records • ${dataset.unique_species} species</div>
                        <div class="dataset-actions">
                            <button class="btn-small btn-view" onclick="loadDataset('${dataset.id}')">👁️ View</button>
                            <button class="btn-small btn-export-enhanced" onclick="openExportModal('${dataset.id}')">📦 Export</button>
                            <button class="btn-small btn-delete" onclick="deleteDataset('${dataset.id}')">🗑️ Delete</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        async function loadDataset(datasetId) {
            try {
                document.getElementById('mapLoading').classList.add('active');
                const response = await fetch(`/api/dataset/${datasetId}/data`);
                const result = await response.json();

                if (result.success) {
                    currentDatasetId = datasetId;
                    currentData = result.data || [];

                    updateVisualization();
                    showAlert(`📊 Loaded dataset with ${result.data.length} observations`, 'success');
                }
            } catch (error) {
                showAlert('Failed to load dataset', 'error');
            } finally {
                document.getElementById('mapLoading').classList.remove('active');
            }
        }

        function updateVisualization() {
            if (!currentData || currentData.length === 0) {
                updateStatistics(); updateChart(); updateTable();
                document.getElementById('speciesLegend').style.display = 'none';
                return;
            }

            markersLayer.clearLayers();
            if (heatmapLayer) map.removeLayer(heatmapLayer);

            if (currentMapMode === 'heatmap') {
                const heatData = currentData.map(d => [d.latitude, d.longitude, d.count || 1]);
                heatmapLayer = L.heatLayer(heatData, {
                    radius: 25, blur: 15, maxZoom: 10
                }).addTo(map);
                document.getElementById('speciesLegend').style.display = 'none';
            } else {
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#FF8E53', '#6C5CE7', '#A29BFE', '#FD79A8', '#FDCB6E'];
                const speciesColors = {};
                const allSpecies = [...new Set(currentData.map(d => d.species))];
                allSpecies.forEach((species, index) => {
                    speciesColors[species] = colors[index % colors.length];
                });

                // Create legend
                let legendHTML = '';
                allSpecies.forEach((species, index) => {
                    const color = colors[index % colors.length];
                    legendHTML += `
                        <div style="display: flex; align-items: center; gap: 8px; background: white; padding: 5px 10px; border-radius: 15px; border: 1px solid #ddd; font-size: 0.85rem;">
                            <div style="width: 12px; height: 12px; background: ${color}; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 3px rgba(0,0,0,0.3);"></div>
                            <span style="color: #2E8B57; font-weight: 500;">${species}</span>
                        </div>
                    `;
                });
                document.getElementById('legendItems').innerHTML = legendHTML;
                document.getElementById('speciesLegend').style.display = 'block';

                currentData.forEach(d => {
                    if (d.latitude && d.longitude) {
                        const marker = L.circleMarker([d.latitude, d.longitude], {
                            radius: Math.max(8, Math.min(d.count * 2, 15)),
                            fillColor: speciesColors[d.species],
                            color: '#fff',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.8
                        });

                        const popupContent = `
                            <div style="font-family: Arial, sans-serif; min-width: 250px; max-width: 300px;">
                                <h3 style="color: #2E8B57; margin: 0 0 12px 0; font-size: 18px; border-bottom: 2px solid #2E8B57; padding-bottom: 8px; text-align: center;">${d.species}</h3>
                                <div style="font-size: 15px; line-height: 1.8;">
                                    <div style="margin: 8px 0; padding: 6px; background: #f8f9fa; border-radius: 5px;">
                                        <strong style="color: #666;">Count:</strong> 
                                        <span style="color: #2E8B57; font-weight: bold; font-size: 16px;">${d.count || 1}</span>
                                    </div>
                                    ${d.location ? `<div style="margin: 8px 0; padding: 6px; background: #f8f9fa; border-radius: 5px;">
                                        <strong style="color: #666;">Location:</strong> ${d.location}
                                    </div>` : ''}
                                    <div style="margin: 8px 0; padding: 6px; background: #f8f9fa; border-radius: 5px;">
                                        <strong style="color: #666;">Coordinates:</strong><br>
                                        Lat: ${d.latitude.toFixed(6)}°<br>
                                        Lng: ${d.longitude.toFixed(6)}°
                                    </div>
                                    ${d.date ? `<div style="margin: 8px 0; padding: 6px; background: #f8f9fa; border-radius: 5px;">
                                        <strong style="color: #666;">Date:</strong> ${d.date}
                                    </div>` : ''}
                                </div>
                            </div>
                        `;

                        marker.bindPopup(popupContent, {
                            maxWidth: 320,
                            minWidth: 250,
                            maxHeight: 400,
                            autoPan: true,
                            closeButton: true,
                            autoClose: false,
                            closeOnEscapeKey: true
                        });

                        markersLayer.addLayer(marker);
                    }
                });
            }

            updateStatistics(); updateChart(); updateTable();
        }

        function updateStatistics() {
            const totalObs = currentData.reduce((sum, d) => sum + (d.count || 1), 0);
            const uniqueSpecies = [...new Set(currentData.map(d => d.species))].length;
            const uniqueLocations = [...new Set(currentData.map(d => `${d.latitude},${d.longitude}`))].length;
            const avgDensity = uniqueLocations > 0 ? (totalObs / uniqueLocations).toFixed(1) : '0';

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card"><div class="stat-value">${totalObs.toLocaleString()}</div><div class="stat-label">Total Observations</div></div>
                <div class="stat-card"><div class="stat-value">${uniqueSpecies}</div><div class="stat-label">Unique Species</div></div>
                <div class="stat-card"><div class="stat-value">${uniqueLocations}</div><div class="stat-label">Survey Locations</div></div>
                <div class="stat-card"><div class="stat-value">${avgDensity}/km²</div><div class="stat-label">Avg. Density</div></div>
            `;
        }

        function updateChart() {
            const speciesStats = {};
            currentData.forEach(d => {
                if (!speciesStats[d.species]) speciesStats[d.species] = 0;
                speciesStats[d.species] += (d.count || 1);
            });

            const sorted = Object.entries(speciesStats).sort((a, b) => b[1] - a[1]).slice(0, 10);
            speciesChart.data.labels = sorted.map(s => s[0].length > 15 ? s[0].substring(0, 15) + '...' : s[0]);
            speciesChart.data.datasets[0].data = sorted.map(s => s[1]);
            speciesChart.update();
        }

        function updateTable() {
            const speciesStats = {};
            currentData.forEach(d => {
                if (!speciesStats[d.species]) speciesStats[d.species] = { count: 0, observations: 0 };
                speciesStats[d.species].count += (d.count || 1);
                speciesStats[d.species].observations += 1;
            });

            const sortedSpecies = Object.entries(speciesStats).sort((a, b) => b[1].count - a[1].count);
            let tableHTML = '<thead><tr><th>Species</th><th>Total Count</th><th>Observations</th><th>Avg. per Observation</th><th>Density</th></tr></thead><tbody>';

            if (sortedSpecies.length === 0) {
                tableHTML += '<tr><td colspan="5" style="text-align: center; color: #999; padding: 30px;">No data to display</td></tr>';
            } else {
                sortedSpecies.forEach(([species, stats]) => {
                    const avgPerObs = (stats.count / stats.observations).toFixed(1);
                    const density = (stats.count / Math.max(stats.observations, 1)).toFixed(2);
                    tableHTML += `<tr><td><strong>${species}</strong></td><td>${stats.count}</td><td>${stats.observations}</td><td>${avgPerObs}</td><td>${density}</td></tr>`;
                });
            }
            tableHTML += '</tbody>';
            document.getElementById('dataTable').innerHTML = tableHTML;
        }

        function fitMapBounds() {
            if (currentData.length > 0) {
                const bounds = currentData.map(d => [d.latitude, d.longitude]);
                map.fitBounds(bounds, { padding: [20, 20] });
            }
        }

        function toggleHeatmapMode() {
            currentMapMode = 'heatmap';
            document.getElementById('toggleHeatmap').classList.add('active');
            document.getElementById('toggleMarkers').classList.remove('active');
            updateVisualization();
        }

        function toggleMarkerMode() {
            currentMapMode = 'markers';
            document.getElementById('toggleMarkers').classList.add('active');
            document.getElementById('toggleHeatmap').classList.remove('active');
            updateVisualization();
        }

        // Export Functions
        function openExportModal(datasetId) {
            selectedExportDatasetId = datasetId;
            document.getElementById('exportModal').style.display = 'block';
            document.getElementById('enhancedExportContent').style.display = 'none';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
            document.getElementById('enhancedExportContent').style.display = 'none';
            selectedExportDatasetId = null;
            currentExportData = null;
        }

        async function exportCSV() {
            if (!selectedExportDatasetId) return;

            try {
                showAlert('Preparing CSV export...', 'success');
                const link = document.createElement('a');
                link.href = `/api/dataset/${selectedExportDatasetId}/export`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showAlert('CSV exported successfully!', 'success');
                closeExportModal();
            } catch (error) {
                showAlert('Failed to export CSV', 'error');
            }
        }

        async function exportEnhanced() {
            if (!selectedExportDatasetId) {
                showAlert('No dataset selected for export', 'error');
                return;
            }

            try {
                showAlert('Generating interactive HTML files...', 'success');

                const response = await fetch(`/api/dataset/${selectedExportDatasetId}/export/enhanced`);
                const result = await response.json();

                if (result.success) {
                    currentExportData = result;
                    showExportPreview(result);
                    document.getElementById('enhancedExportContent').style.display = 'block';
                    showAlert('Interactive HTML files generated successfully!', 'success');
                } else {
                    showAlert('Failed to generate files: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Failed to generate interactive files: ' + error.message, 'error');
            }
        }

        function showExportPreview(result) {
            document.getElementById('previewStats').innerHTML = `
                <h4 style="color: #2E8B57;">Dataset: ${result.dataset_name}</h4>
                <p><strong>Total Observations:</strong> ${result.stats.total_observations.toLocaleString()} | 
                <strong>Unique Species:</strong> ${result.stats.unique_species} | 
                <strong>Survey Locations:</strong> ${result.stats.unique_locations}</p>
            `;

            document.getElementById('previewFiles').innerHTML = `
                <div class="preview-file">
                    <h4>Interactive Heatmap</h4>
                    <p>Combined species density visualization</p>
                    <button onclick="downloadFile('${result.files.interactive_heatmap}', 'interactive_heatmap.html')" class="download-btn">Download HTML</button>
                </div>
                <div class="preview-file">
                    <h4>Interactive Dashboard</h4>
                    <p>View markers map and pie chart directly</p>
                    <button onclick="viewDashboardInteractive()" class="download-btn" style="background: #17a2b8;">View Dashboard</button>
                </div>
            `;

            if (result.files.species_heatmaps && Object.keys(result.files.species_heatmaps).length > 0) {
                document.getElementById('speciesSection').style.display = 'block';

                let speciesHTML = '';
                for (const [species, filePath] of Object.entries(result.files.species_heatmaps)) {
                    const shortName = species.length > 20 ? species.substring(0, 20) + '...' : species;
                    const fileName = `${species.replace(/[^a-zA-Z0-9]/g, '_')}_heatmap.html`;
                    speciesHTML += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 0.9rem; font-weight: 600; color: #2E8B57; margin-bottom: 8px;" title="${species}">${shortName}</div>
                            <button onclick="downloadFile('${filePath}', '${fileName}')" class="download-btn" style="font-size: 0.8rem; padding: 5px 10px;">Download</button>
                        </div>
                    `;
                }
                document.getElementById('speciesGrid').innerHTML = speciesHTML;
            } else {
                document.getElementById('speciesSection').style.display = 'none';
            }
        }

        function viewDashboardInteractive() {
            // Close export modal
            closeExportModal();

            // Switch to marker mode (no heatmap)
            currentMapMode = 'markers';
            document.getElementById('toggleMarkers').classList.add('active');
            document.getElementById('toggleHeatmap').classList.remove('active');

            // Update visualization to show markers
            updateVisualization();

            // Scroll to show both map and chart
            document.getElementById('map').scrollIntoView({ behavior: 'smooth', block: 'center' });

            showAlert('Dashboard view activated! Showing interactive markers map and pie chart.', 'success');
        }

        function downloadFile(url, filename) {
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                })
                .catch(error => {
                    console.error('Download failed:', error);
                    showAlert('Download failed. Opening file in new tab instead.', 'error');
                    window.open(url, '_blank');
                });
        }

        function downloadAllSpecies() {
            if (!currentExportData || !currentExportData.files.species_heatmaps) return;

            const speciesFiles = Object.entries(currentExportData.files.species_heatmaps);
            let downloadCount = 0;

            speciesFiles.forEach(([species, filePath], index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = filePath;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    downloadCount++;
                    if (downloadCount === speciesFiles.length) {
                        showAlert(`All ${speciesFiles.length} species maps downloaded!`, 'success');
                    }
                }, index * 300);
            });

            showAlert(`Downloading ${speciesFiles.length} species maps...`, 'success');
        }

        async function deleteDataset(datasetId) {
            if (!confirm('Are you sure you want to delete this dataset?')) return;

            try {
                const response = await fetch(`/api/dataset/${datasetId}/delete`, { method: 'DELETE' });
                const result = await response.json();

                if (result.success) {
                    showAlert('Dataset deleted successfully', 'success');
                    if (currentDatasetId === datasetId) {
                        currentDatasetId = null;
                        currentData = [];
                        markersLayer.clearLayers();
                        if (heatmapLayer) map.removeLayer(heatmapLayer);
                        updateStatistics();
                        updateChart();
                        updateTable();
                    }
                    await loadDatasetsList();
                }
            } catch (error) {
                showAlert('Failed to delete dataset', 'error');
            }
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);

            if (type === 'success') {
                setTimeout(() => {
                    if (alertDiv.parentNode) alertDiv.remove();
                }, 4000);
            }
        }

        window.onclick = function (event) {
            const modal = document.getElementById('exportModal');
            if (event.target == modal) {
                closeExportModal();
            }
        }

        function initApp() {
            if (typeof L === 'undefined' || typeof Chart === 'undefined') {
                setTimeout(initApp, 100);
                return;
            }

            console.log('Species Database initialized!');
            loadDatasetsList();
            loadBoundaryList();

            // Add file input event listener
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleFileUpload);
            }
        }

        function showResourcePage(resourceType) {
            const resourceContent = {
                'documentation': {
                    title: 'Data Format Guide',
                    content: `
                        <h3>Supported File Formats</h3>
                        <h4>Species Data Files:</h4>
                        <ul>
                            <li><strong>CSV Files:</strong> Comma-separated values with proper headers</li>
                            <li><strong>Excel Files:</strong> .xlsx or .xls format</li>
                        </ul>
                        
                        <h4>Required Columns:</h4>
                        <ul>
                            <li><strong>Species:</strong> Scientific or common name</li>
                            <li><strong>Latitude:</strong> Decimal degrees</li>
                            <li><strong>Longitude:</strong> Decimal degrees</li>
                            <li><strong>Count:</strong> Number of individuals (optional, defaults to 1)</li>
                            <li><strong>Date:</strong> Observation date (optional)</li>
                            <li><strong>Location:</strong> Place name (optional)</li>
                        </ul>
                        
                        <h4>Boundary Files:</h4>
                        <ul>
                            <li><strong>KML Files:</strong> Google Earth format for study area boundaries</li>
                            <li><strong>KMZ Files:</strong> Compressed KML files</li>
                        </ul>
                    `
                },
                'tutorials': {
                    title: 'How to Use',
                    content: `
                        <h3>Getting Started</h3>
                        <ol>
                            <li><strong>Upload Data:</strong> Go to Features page and click the upload area</li>
                            <li><strong>Select Files:</strong> Choose your CSV/Excel files with species data</li>
                            <li><strong>Add Boundaries:</strong> Optionally upload KML files for study areas</li>
                            <li><strong>View Analysis:</strong> Explore maps, charts, and statistics</li>
                            <li><strong>Export Results:</strong> Generate interactive reports</li>
                        </ol>
                        
                        <h3>Map Controls</h3>
                        <ul>
                            <li><strong>Markers View:</strong> See individual observation points</li>
                            <li><strong>Heatmap View:</strong> Visualize species density</li>
                            <li><strong>Fit View:</strong> Zoom to show all data points</li>
                            <li><strong>Study Areas:</strong> Select boundaries to overlay</li>
                        </ul>
                        
                        <h3>Export Options</h3>
                        <ul>
                            <li><strong>CSV Export:</strong> Raw data for further analysis</li>
                            <li><strong>Interactive Maps:</strong> HTML files with full functionality</li>
                            <li><strong>Species Maps:</strong> Individual heatmaps per species</li>
                        </ul>
                    `
                },
                'bird-identification': {
                    title: 'Bird ID Guide',
                    content: `
                        <h3>Common Indian Bird Species</h3>
                        <h4>Resident Species:</h4>
                        <ul>
                            <li><strong>House Sparrow (Passer domesticus):</strong> Small brown bird, common in urban areas</li>
                            <li><strong>Indian Robin (Copsychus fulicatus):</strong> Black with white patches, distinctive upright tail</li>
                            <li><strong>Asian Koel (Eudynamys scolopaceus):</strong> Black male, brown spotted female</li>
                            <li><strong>Rose-ringed Parakeet (Psittacula krameri):</strong> Green with red beak</li>
                            <li><strong>Spot-billed Duck (Anas poecilorhyncha):</strong> Brown duck with yellow-tipped bill</li>
                        </ul>
                        
                        <h4>Identification Tips:</h4>
                        <ul>
                            <li>Note size, color patterns, and behavior</li>
                            <li>Observe habitat preferences</li>
                            <li>Listen to calls and songs</li>
                            <li>Check for seasonal variations</li>
                        </ul>
                        
                        <h4>Resources:</h4>
                        <ul>
                            <li>Birds of India field guides</li>
                            <li>eBird database</li>
                            <li>Local bird watching groups</li>
                        </ul>
                    `
                },
                'methodology': {
                    title: 'Research Methodology',
                    content: `
                        <h3>Data Collection Standards</h3>
                        <ul>
                            <li><strong>Point Counts:</strong> Fixed duration observations at specific locations</li>
                            <li><strong>Transect Surveys:</strong> Linear sampling along predetermined routes</li>
                            <li><strong>Grid Sampling:</strong> Systematic coverage of study areas</li>
                            <li><strong>GPS Accuracy:</strong> Minimum 3-meter precision for location data</li>
                        </ul>
                        
                        <h3>Statistical Analysis</h3>
                        <ul>
                            <li><strong>Species Richness:</strong> Total number of species recorded</li>
                            <li><strong>Abundance:</strong> Count of individuals per species</li>
                            <li><strong>Density Mapping:</strong> Spatial distribution analysis</li>
                            <li><strong>Diversity Indices:</strong> Shannon-Weaver, Simpson's indices</li>
                        </ul>
                        
                        <h3>Quality Control</h3>
                        <ul>
                            <li>Data validation and error checking</li>
                            <li>Taxonomic name verification</li>
                            <li>Coordinate accuracy assessment</li>
                            <li>Duplicate record identification</li>
                        </ul>
                    `
                },
                'publications': {
                    title: 'Publications',
                    content: `
                        <h3>Delhi Bird Atlas Publications</h3>
                        <ul>
                            <li><strong>"Avian Diversity of Delhi NCR"</strong> - Comprehensive species inventory</li>
                            <li><strong>"Urban Bird Distribution Patterns"</strong> - Spatial analysis study</li>
                            <li><strong>"Seasonal Migration Patterns"</strong> - Temporal analysis</li>
                            <li><strong>"Conservation Status Assessment"</strong> - Threat analysis</li>
                        </ul>
                        
                        <h3>Related Research</h3>
                        <ul>
                            <li>Bird conservation in urban environments</li>
                            <li>Habitat preference studies</li>
                            <li>Climate change impact assessments</li>
                            <li>Citizen science contributions</li>
                        </ul>
                        
                        <h3>Data Sharing</h3>
                        <p>Our research data contributes to:</p>
                        <ul>
                            <li>eBird global database</li>
                            <li>Biodiversity conservation efforts</li>
                            <li>Academic research collaborations</li>
                            <li>Environmental impact assessments</li>
                        </ul>
                    `
                },
                'privacy': {
                    title: 'Privacy Policy',
                    content: `
                        <h3>Data Collection</h3>
                        <p>We collect only the data you voluntarily provide:</p>
                        <ul>
                            <li>Species observation data from uploaded files</li>
                            <li>Geographic coordinates</li>
                            <li>Observation dates and locations</li>
                        </ul>
                        
                        <h3>Data Usage</h3>
                        <ul>
                            <li>Processing and analysis for biodiversity research</li>
                            <li>Generating maps and statistical reports</li>
                            <li>Contributing to conservation efforts</li>
                        </ul>
                        
                        <h3>Data Storage</h3>
                        <ul>
                            <li>Data is stored temporarily during your session</li>
                            <li>No personal information is permanently stored</li>
                            <li>You can delete your data at any time</li>
                        </ul>
                        
                        <h3>Data Sharing</h3>
                        <ul>
                            <li>Your data is not shared with third parties</li>
                            <li>Aggregated, anonymous data may be used for research</li>
                            <li>You retain full control over your uploaded data</li>
                        </ul>
                    `
                },
                'terms': {
                    title: 'Terms of Service',
                    content: `
                        <h3>Acceptable Use</h3>
                        <ul>
                            <li>Use the platform for legitimate research purposes</li>
                            <li>Provide accurate species and location data</li>
                            <li>Respect intellectual property rights</li>
                            <li>Do not upload malicious or inappropriate content</li>
                        </ul>
                        
                        <h3>Data Responsibility</h3>
                        <ul>
                            <li>You are responsible for the accuracy of uploaded data</li>
                            <li>Ensure you have rights to share the data</li>
                            <li>Verify species identifications before submission</li>
                        </ul>
                        
                        <h3>Platform Availability</h3>
                        <ul>
                            <li>Service provided "as is" without warranties</li>
                            <li>We strive for 99% uptime but cannot guarantee availability</li>
                            <li>Regular maintenance may cause temporary interruptions</li>
                        </ul>
                        
                        <h3>Limitation of Liability</h3>
                        <ul>
                            <li>Platform for research and educational purposes</li>
                            <li>Users responsible for data backup and validation</li>
                            <li>Not liable for data loss or analysis errors</li>
                        </ul>
                    `
                },
                'data-usage': {
                    title: 'Data Usage Policy',
                    content: `
                        <h3>Research Applications</h3>
                        <ul>
                            <li><strong>Biodiversity Assessment:</strong> Species richness and distribution analysis</li>
                            <li><strong>Conservation Planning:</strong> Identifying priority areas for protection</li>
                            <li><strong>Environmental Monitoring:</strong> Tracking ecosystem health</li>
                            <li><strong>Climate Studies:</strong> Understanding species response to change</li>
                        </ul>
                        
                        <h3>Data Quality Standards</h3>
                        <ul>
                            <li>Coordinate accuracy within 10 meters</li>
                            <li>Valid taxonomic names required</li>
                            <li>Observation dates in standard format</li>
                            <li>Quality control checks performed automatically</li>
                        </ul>
                        
                        <h3>Attribution Requirements</h3>
                        <ul>
                            <li>Credit data contributors in publications</li>
                            <li>Reference the Delhi Bird Atlas project</li>
                            <li>Follow scientific naming conventions</li>
                            <li>Acknowledge data sources appropriately</li>
                        </ul>
                    `
                },
                'support': {
                    title: 'Technical Support',
                    content: `
                        <h3>Common Issues</h3>
                        <h4>File Upload Problems:</h4>
                        <ul>
                            <li>Ensure files are in CSV, Excel, KML, or KMZ format</li>
                            <li>Check that required columns are present</li>
                            <li>Verify file size is under 100MB</li>
                            <li>Remove special characters from file names</li>
                        </ul>
                        
                        <h4>Map Display Issues:</h4>
                        <ul>
                            <li>Check internet connection</li>
                            <li>Refresh the page if map doesn't load</li>
                            <li>Ensure browser JavaScript is enabled</li>
                            <li>Try a different browser if problems persist</li>
                        </ul>
                        
                        <h3>Browser Compatibility</h3>
                        <ul>
                            <li>Chrome 90+ (Recommended)</li>
                            <li>Firefox 88+</li>
                            <li>Safari 14+</li>
                            <li>Edge 90+</li>
                        </ul>
                        
                        <h3>Contact Support</h3>
                        <p>For technical issues, contact us at:</p>
                        <ul>
                            <li>Email: contact@birdspeciesdb.com</li>
                            <li>Instagram: @delhi_birdatlas</li>
                        </ul>
                    `
                },
                'feedback': {
                    title: 'Feedback & Suggestions',
                    content: `
                        <h3>We Value Your Input</h3>
                        <p>Help us improve the Bird Species Database platform:</p>
                        
                        <h4>Feature Requests:</h4>
                        <ul>
                            <li>Suggest new analysis tools</li>
                            <li>Request additional export formats</li>
                            <li>Propose visualization improvements</li>
                            <li>Recommend new bird identification features</li>
                        </ul>
                        
                        <h4>Bug Reports:</h4>
                        <ul>
                            <li>Describe the issue clearly</li>
                            <li>Include browser and operating system</li>
                            <li>Provide steps to reproduce the problem</li>
                            <li>Attach screenshots if helpful</li>
                        </ul>
                        
                        <h4>General Feedback:</h4>
                        <ul>
                            <li>User experience suggestions</li>
                            <li>Documentation improvements</li>
                            <li>New research collaborations</li>
                            <li>Educational outreach ideas</li>
                        </ul>
                        
                        <h3>Contact Methods</h3>
                        <ul>
                            <li><strong>Email:</strong> contact@birdspeciesdb.com</li>
                            <li><strong>Instagram:</strong> @delhi_birdatlas</li>
                        </ul>
                        
                        <p>We review all feedback and respond within 48 hours.</p>
                    `
                }
            };

            const resource = resourceContent[resourceType];
            if (resource) {
                // Create modal content
                const modalHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeResourceModal(event)">
                        <div style="background: white; border-radius: 15px; max-width: 800px; max-height: 80vh; overflow-y: auto; margin: 20px; position: relative;" onclick="event.stopPropagation();">
                            <div style="padding: 30px;">
                                <button onclick="closeResourceModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                                <h2 style="color: #2E8B57; margin-bottom: 20px; font-size: 2rem;">${resource.title}</h2>
                                <div style="line-height: 1.6; color: #333;">
                                    ${resource.content}
                                </div>
                                <div style="margin-top: 30px; text-align: center;">
                                    <button onclick="closeResourceModal()" style="background: #2E8B57; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add modal to body
                const modalDiv = document.createElement('div');
                modalDiv.id = 'resourceModal';
                modalDiv.innerHTML = modalHTML;
                document.body.appendChild(modalDiv);
            }
        }

        function closeResourceModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('resourceModal');
            if (modal) {
                modal.remove();
            }
        }
    </script>
</body>

</html>